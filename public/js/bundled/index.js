require("regenerator-runtime/runtime");var e=require("axios");function t(e){return e&&e.__esModule?e.default:e}const s=()=>{const e=document.querySelector(".alert");e&&e.parentElement.removeChild(e)},a=(e,t)=>{s();const a=`<div class="alert alert--${e}">${t}</div>`;document.querySelector("body").insertAdjacentHTML("afterbegin",a),setTimeout(s,5e3)},n=async(s,n)=>{try{"success"===(await t(e)({method:"POST",url:"/api/v1/users/login",data:{email:s,password:n}})).data.status&&(a("success","Logged in successfully"),window.setTimeout((()=>{location.assign("/")}),1500))}catch(e){a("error",e.response.data.message)}},o=e=>{const t=L.map("map").setView([31.111745,-118.113491],5);L.tileLayer("https://tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19,attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'}).addTo(t);const s=[];e.forEach((e=>{const a=[...e.coordinates].reverse(),n=L.icon({iconUrl:"./../img/pin.png",iconSize:[30,35],iconAnchor:[15,35]});L.marker(a,{icon:n}).addTo(t),s.push(a)}));const a=L.latLngBounds(s);t.fitBounds(a)},r=async(s,n)=>{try{"success"===(await t(e)({method:"PATCH",url:"/api/v1/users/"+("data"===n?"updateMe":"updateMyPassword"),data:s})).data.status&&a("success",`${n[0].toUpperCase()+n.slice(1)} updated successfully`)}catch(e){a("error",e.response.data.message)}},c=Stripe("pk_test_51MnlgALoWQNLaTPB0KjvezW9oCw5sf9rzjh7IsMttSiRy5FMx8NdKTVmYZiK5CI49bzej60vRgqt4ZBRx8ns2O9100Tu94fkdI"),d=async s=>{try{const a=await t(e)(`/api/v1/bookings/checkout-session/${s}`);await c.redirectToCheckout({sessionId:a.data.session.id})}catch(e){a("error",e)}},u=async(s,n,o,r)=>{try{const c=document.getElementById("signup-btn");c.textContent="Processing...";const d=await t(e)({method:"POST",url:"/api/v1/users/signup",data:{name:s,email:n,password:o,passwordConfirm:r}});c.textContent="Signup","success"===d.data.status&&(a("success","Created account successfully"),window.setTimeout((()=>{location.assign("/")}),1500))}catch(e){a("error",e.response.data.message)}},i=async s=>{try{const n=document.getElementById("forgot-btn");n.textContent="Processing...";const o=await t(e)({method:"POST",url:"/api/v1/users/forgotPassword",data:{email:s}});n.textContent="Send","success"===o.data.status&&a("success","Email succesfully sent!")}catch(e){a("error",e.response.data.message)}},l=async(s,n)=>{try{const o=document.getElementById("reset-btn");o.textContent="Processing...";const r=window.location.pathname.split("/").pop(),c=await t(e)({method:"PATCH",url:`/api/v1/users/resetPassword/${r}`,data:{password:s,passwordConfirm:n}});o.textContent="Reset","success"===c.data.status&&(a("success","Password changed!"),window.setTimeout((()=>{location.assign("/login")}),1500))}catch(e){a("error",e.response.data.message)}},m=async(s,n,o)=>{try{"success"===(await t(e)({method:"POST",url:`/api/v1/tours/${o}/reviews`,data:{review:s,rating:n}})).data.status&&(a("success","Review created!"),window.setTimeout((()=>{location.reload()}),1500))}catch(e){a("error",e.response.data.message)}},p=()=>{for(let e=1;e<=5;e++){const t=document.getElementById(`star-${e}`).closest(".star-container").querySelector(".reviews__star-svg");t.classList.remove("reviews__star--active"),t.classList.add("reviews__star--inactive")}},g=e=>{for(let t=1;t<=e;t++){const e=document.getElementById(`star-${t}`).closest(".star-container").querySelector(".reviews__star-svg");e.classList.add("reviews__star--active"),e.classList.remove("reviews__star--inactive")}},v=document.getElementById("map"),y=document.querySelector(".form--login"),w=document.querySelector(".form--signup"),f=document.querySelector(".form--forgot"),E=document.querySelector(".form--reset"),I=document.querySelector(".form--review"),h=document.querySelector(".form-user-data"),S=document.querySelector(".form-user-password"),B=document.querySelector(".nav__el--logout"),C=document.getElementById("book-tour");if(v){o(JSON.parse(v.dataset.locations))}y&&y.addEventListener("submit",(e=>{e.preventDefault();const t=document.getElementById("login-email").value,s=document.getElementById("login-password").value;n(t,s)})),w&&w.addEventListener("submit",(e=>{e.preventDefault();const t=document.getElementById("signup-name").value,s=document.getElementById("signup-email").value,a=document.getElementById("signup-password").value,n=document.getElementById("signup-password").value;u(t,s,a,n)})),f&&f.addEventListener("submit",(e=>{e.preventDefault();const t=document.getElementById("forgot-email").value;i(t)})),E&&E.addEventListener("submit",(e=>{e.preventDefault();const t=document.getElementById("reset-password").value,s=document.getElementById("reset-password-confirm").value;l(t,s)})),I&&(I.addEventListener("submit",(e=>{e.preventDefault();const t=document.getElementById("review-text").value,s=+document.querySelector('input[name="star"]:checked').id.split("-")[1],{tourId:a}=e.target.dataset;m(t,s,a)})),document.querySelector(".reviews__star-rating").addEventListener("click",(e=>{if(!e.target.id)return;const t=e.target.id.split("-")[1];p(),g(t)}))),B&&B.addEventListener("click",(async()=>{try{"success"===(await t(e)({method:"GET",url:"/api/v1/users/logout"})).data.status&&location.assign("/")}catch(e){a("error","Error logging out! Try again.")}})),h&&h.addEventListener("submit",(async e=>{e.preventDefault(),document.querySelector(".btn--save-settings").textContent="Updating";const t=new FormData;t.append("name",document.getElementById("name").value),t.append("email",document.getElementById("email").value),t.append("photo",document.getElementById("photo").files[0]),await r(t,"data"),document.querySelector(".btn--save-settings").textContent="Save settings",location.reload()})),S&&S.addEventListener("submit",(async e=>{e.preventDefault(),document.querySelector(".btn--save-password").textContent=" Updating";const t=document.getElementById("password-current").value,s=document.getElementById("password").value,a=document.getElementById("password-confirm").value;await r({passwordCurrent:t,password:s,passwordConfirm:a},"password"),document.querySelector(".btn--save-password").textContent=" Save Password",document.getElementById("password-current").value="",document.getElementById("password").value="",document.getElementById("password-confirm").value=""})),C&&C.addEventListener("click",(e=>{e.target.textContent="Processing...";const{tourId:t}=e.target.dataset;d(t)}));
//# sourceMappingURL=index.js.map
